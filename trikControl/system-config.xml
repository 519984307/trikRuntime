<!-- TrikControl system configuration file. -->

<config>
	<!-- Initialization sh script, will be executed when runtime is launched. -->
	<initScript>
		echo 1 > /sys/class/gpio/gpio62/value

		i2cset -y 2 0x48 0x10 0x1000 w
		i2cset -y 2 0x48 0x11 0x1000 w
		i2cset -y 2 0x48 0x12 0x1000 w
		i2cset -y 2 0x48 0x13 0x1000 w

		echo 1 > /sys/class/pwm/ehrpwm.1:1/request
		echo 1 > /sys/class/pwm/ehrpwm.1:1/run

		echo 1 > /sys/class/pwm/ehrpwm.1:0/request
		echo 1 > /sys/class/pwm/ehrpwm.1:0/run

		echo 1 > /sys/class/pwm/ehrpwm.0:1/request
		echo 1 > /sys/class/pwm/ehrpwm.0:1/run

		echo 1 > /sys/class/pwm/ecap.0/request
		echo 1 > /sys/class/pwm/ecap.0/run

		echo 1 > /sys/class/pwm/ecap.1/request
		echo 1 > /sys/class/pwm/ecap.1/run

		echo 1 > /sys/class/pwm/ecap.2/request
		echo 1 > /sys/class/pwm/ecap.2/run

		#cat /sys/class/pwm/ecap_cap.0/config > /dev/null

		#cat /sys/class/pwm/ecap_cap.1/config > /dev/null

		#cat /sys/class/pwm/ecap_cap.2/config > /dev/null

		echo 1 > /sys/devices/virtual/input/input1/enable_device

		amixer -q set PCM 127
	</initScript>

	<deviceClasses>
		<servoMotor
			port="E1"
			deviceFile="/sys/class/pwm/ehrpwm.1:1/duty_ns"
			periodFile="/sys/class/pwm/ehrpwm.1:1/period_ns"
		/>
		<servoMotor
			port="E2"
			deviceFile="/sys/class/pwm/ehrpwm.1:0/duty_ns"
			periodFile="/sys/class/pwm/ehrpwm.1:0/period_ns"
		/>
		<servoMotor
			port="E3"
			deviceFile="/sys/class/pwm/ehrpwm.0:1/duty_ns"
			periodFile="/sys/class/pwm/ehrpwm.0:1/period_ns"
		/>
		<servoMotor
			port="C1"
			deviceFile="/sys/class/pwm/ecap.0/duty_ns"
			periodFile="/sys/class/pwm/ecap.0/period_ns"
		/>
		<servoMotor
			port="C2"
			deviceFile="/sys/class/pwm/ecap.1/duty_ns"
			periodFile="/sys/class/pwm/ecap.1/period_ns"
		/>
		<servoMotor
			port="C3"
			deviceFile="/sys/class/pwm/ecap.2/duty_ns"
			periodFile="/sys/class/pwm/ecap.2/period_ns"
		/>
		<pwmCapture
			port="C1"
			frequencyFile="/sys/class/pwm/ecap_cap.0/freq"
			dutyFile="/sys/class/pwm/ecap_cap.0/duty_percentage"
		/>
		<pwmCapture
			port="C2"
			frequencyFile="/sys/class/pwm/ecap_cap.1/freq"
			dutyFile="/sys/class/pwm/ecap_cap.1/duty_percentage"
		/>
		<pwmCapture
			port="C3"
			frequencyFile="/sys/class/pwm/ecap_cap.2/freq"
			dutyFile="/sys/class/pwm/ecap_cap.2/duty_percentage"
		/>
		<powerMotor port="M1" i2cCommandNumber="0x14" />
		<powerMotor port="M2" i2cCommandNumber="0x15" />
		<powerMotor port="M3" i2cCommandNumber="0x17" />
		<powerMotor port="M4" i2cCommandNumber="0x16" />
		<analogSensor port="A1" i2cCommandNumber="0x25" />
		<analogSensor port="A2" i2cCommandNumber="0x24" />
		<analogSensor port="A3" i2cCommandNumber="0x23" />
		<analogSensor port="A4" i2cCommandNumber="0x22" />
		<analogSensor port="A5" i2cCommandNumber="0x21" />
		<analogSensor port="A6" i2cCommandNumber="0x20" />
		<encoder port="B1" i2cCommandNumber="0x30" />
		<encoder port="B2" i2cCommandNumber="0x31" />
		<encoder port="B3" i2cCommandNumber="0x32" />
		<encoder port="B4" i2cCommandNumber="0x33" />
		<rangeSensor port="D1" eventFile="/dev/input/by-path/platform-trik_jd1-event" />
		<rangeSensor port="D2" eventFile="/dev/input/by-path/platform-trik_jd2-event" />
		<digitalSensor port="F1" deviceFile="/sys/devices/platform/da850_trik/sensor_dc" />
		<accelerometer deviceFile="/dev/input/event1" />
		<gyroscope deviceFile="/dev/input/by-path/platform-spi_davinci.1-event" />
		<lineSensor port="video0" script="/etc/init.d/line-sensor-ov7670.sh" inputFile="/run/line-sensor.in.fifo" outputFile="/run/line-sensor.out.fifo" toleranceFactor="1.0" disabled="false" />
		<lineSensor port="video1" script="/etc/init.d/line-sensor-ov7670.sh" inputFile="/run/line-sensor.in.fifo" outputFile="/run/line-sensor.out.fifo" toleranceFactor="1.0" disabled="false" />
		<objectSensor port="video0" script="/etc/init.d/object-sensor-ov7670.sh" inputFile="/run/object-sensor.in.fifo" outputFile="/run/object-sensor.out.fifo" toleranceFactor="1.0" disabled="false" />
		<objectSensor port="video1" script="/etc/init.d/object-sensor-ov7670.sh" inputFile="/run/object-sensor.in.fifo" outputFile="/run/object-sensor.out.fifo" toleranceFactor="1.0" disabled="false" />
		<colorSensor port="video0" script="/etc/init.d/mxn-sensor-ov7670.sh" inputFile="/run/mxn-sensor.in.fifo" outputFile="/run/mxn-sensor.out.fifo" m="3" n="3" disabled="false" />
		<colorSensor port="video1" script="/etc/init.d/mxn-sensor-ov7670.sh" inputFile="/run/mxn-sensor.in.fifo" outputFile="/run/mxn-sensor.out.fifo" m="3" n="3" disabled="false" />
	</deviceClasses>

	<deviceTypes>
		<angularServomotor class="servoMotor" min="600000" max="2200000" zero="1400000" stop="0" type="angular" />
		<continuousRotationServomotor class="servoMotor" min="600000" max="2200000" zero="1400000" stop="0" type="continuousRotation" />
		<pwmCapture class="pwmCapture" />
		<irSensor class="analogSensor" rawValue1="0" rawValue2="1024" normalizedValue1="0" normalizedValue2="100" />
		<sonarSensor class="rangeSensor" rawValue1="750" rawValue2="400" normalizedValue1="10" normalizedValue2="20" />
		<lightSensor class="digitalSensor" min="30000" max="350000" />
		<volumeSensor class="digitalSensor" min="0" max="100" />
		<encoder95 class="encoder" rawToDegrees="0.02304708" />
		<encoder126 class="encoder" rawToDegrees="0.03033597" />
	</deviceTypes>

	<!-- Format for playSound command, used to play .wav files. %1 designates file name to be played. -->
	<playWavFile command="aplay --quiet &quot;%1&quot; &amp;" />

	<!-- Format for playSound command, used to play .mp3 files. %1 designates file name to be played. -->
	<playMp3File command="cvlc --quiet &quot;%1&quot; &amp;" />

	<!-- Device files and on/off values for LED on a brick. -->
	<led green="/sys/class/leds/led_green/brightness" red="/sys/class/leds/led_red/brightness" />

	<!--Device file for keys on a brick -->
	<keys deviceFile="/dev/input/event0" />

	<!-- I2C device for communication with power motor drivers. Parameters are path to device file and device id. -->
	<i2c path="/dev/i2c-2" deviceId="0x48" />

	<!-- Settings for gamepad TCP server to communicate with Android "TRIK Gamepad" application -->
	<gamepad port="4444" disabled="false" />

	<!-- Settings for mailbox server (which enables communication between robots) -->
	<mailbox port="8889" disabled="false" />

</config>
