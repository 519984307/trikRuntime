<!--
TrikControl system configuration file. Meant to be written once for each release of OS and shall be the same
for all models running that OS release.

Devices have properties depending on a port to which device is plugged and device class (IR Sensor, Servomotor
and so on), such as device file or I2C device number, and properties common for some devices of given class regardless
of port (for example, we may have two different types of angular servos that have common control interface but
different parameters). So we distinguish "device class" and "device type". "device class" is a class of device as in
underlying C++ code (basically, a logic of communication with particular kind of device), "device type" is a set of
parameters for each device class. Device class can have many device types associated with it (for instance, for
different kinds of servomotors from example above). Device classes are hard-coded, device types are defined in system
config. Every parameter for device type may be overridden in model config, to allow to fine-tune devices for particular
purpose (ability to set the maximum and minimum angles of angular servo proven to be especially useful).

System config has declaration of configurable device classes ("deviceClasses" section) with properties common to all
devices of that class, definition of device-port relations (which device class can be attached to which port and it
also defines port-specific properties like device file) and definition of device types (containing variable parameters
for device class, for example, various raw-to-degree coefficients for different encoders). If device has no variable
parameters, it may be not listed in "device types" section, it is assumed that it has one device type with a name
equal to its class name.
-->

<config>
	<!-- Initialization sh script, will be executed when runtime is launched. -->
	<initScript>
		echo 1 > /sys/class/gpio/gpio62/value

		i2cset -y 2 0x48 0x10 0x1000 w
		i2cset -y 2 0x48 0x11 0x1000 w
		i2cset -y 2 0x48 0x12 0x1000 w
		i2cset -y 2 0x48 0x13 0x1000 w

		echo 1 > /sys/class/pwm/ehrpwm.1:1/request
		echo 1 > /sys/class/pwm/ehrpwm.1:1/run

		echo 1 > /sys/class/pwm/ehrpwm.1:0/request
		echo 1 > /sys/class/pwm/ehrpwm.1:0/run

		echo 1 > /sys/class/pwm/ehrpwm.0:1/request
		echo 1 > /sys/class/pwm/ehrpwm.0:1/run

		echo 1 > /sys/class/pwm/ecap.0/request
		echo 1 > /sys/class/pwm/ecap.0/run

		echo 1 > /sys/class/pwm/ecap.1/request
		echo 1 > /sys/class/pwm/ecap.1/run

		echo 1 > /sys/class/pwm/ecap.2/request
		echo 1 > /sys/class/pwm/ecap.2/run

		#cat /sys/class/pwm/ecap_cap.0/config > /dev/null

		#cat /sys/class/pwm/ecap_cap.1/config > /dev/null

		#cat /sys/class/pwm/ecap_cap.2/config > /dev/null

		echo 1 > /sys/devices/virtual/input/input1/enable_device

		<!-- It is very important to initialize MSP430 USB devices with this parameters -->
		stty 921600 -F /dev/ttyACM0 -echo -onlcr
		stty 921600 -F /dev/ttyACM1 -echo -onlcr

		#amixer -q set PCM 127
	</initScript>

	<!-- A list of known devices. -->
	<deviceClasses>
		<servoMotor period="20000000" invert="false" />
		<pwmCapture />
		<powerMotor invert="false" />
		<analogSensor />
		<encoder />
		<rangeSensor commonModule="hcsr04" />
		<digitalSensor />
		<accelerometer deviceFile="/dev/input/event1" optional="true" />
		<gyroscope deviceFile="/dev/input/by-path/platform-spi_davinci.1-event" optional="true" />
		<lineSensor script="/etc/init.d/line-sensor-ov7670.sh" inputFile="/run/line-sensor.in.fifo" outputFile="/run/line-sensor.out.fifo" toleranceFactor="1.0" />
		<objectSensor script="/etc/init.d/object-sensor-ov7670.sh" inputFile="/run/object-sensor.in.fifo" outputFile="/run/object-sensor.out.fifo" toleranceFactor="1.0" />
		<colorSensor script="/etc/init.d/mxn-sensor-ov7670.sh" inputFile="/run/mxn-sensor.in.fifo" outputFile="/run/mxn-sensor.out.fifo" />
		<soundSensor script="/etc/init.d/sound-sensor-1.sh" inputFile="/run/sound-sensor.in.fifo" outputFile="/run/sound-sensor.out.fifo" />

		<!-- Device files for LED on a brick. -->
		<led green="/sys/class/leds/led_green/brightness" red="/sys/class/leds/led_red/brightness" />

		<!--Device file for keys on a brick -->
                <keys deviceFile="/dev/input/by-path/platform-gpio-keys-event" />

		<!-- Settings for gamepad TCP server to communicate with Android "TRIK Gamepad" application -->
		<gamepad port="4444" optional="true" />

		<!-- Settings for mailbox server (which enables communication between robots) -->
		<mailbox port="8889" optional="true" />
	</deviceClasses>

	<devicePorts>
		<servoMotor
			port="E1"
			deviceFile="/sys/class/pwm/ehrpwm.1:1/duty_ns"
			periodFile="/sys/class/pwm/ehrpwm.1:1/period_ns"
		/>
		<servoMotor
			port="E2"
			deviceFile="/sys/class/pwm/ehrpwm.1:0/duty_ns"
			periodFile="/sys/class/pwm/ehrpwm.1:0/period_ns"
		/>
		<servoMotor
			port="E3"
			deviceFile="/sys/class/pwm/ehrpwm.0:1/duty_ns"
			periodFile="/sys/class/pwm/ehrpwm.0:1/period_ns"
		/>
		<servoMotor
			port="C1"
			deviceFile="/sys/class/pwm/ecap.0/duty_ns"
			periodFile="/sys/class/pwm/ecap.0/period_ns"
		/>
		<servoMotor
			port="C2"
			deviceFile="/sys/class/pwm/ecap.1/duty_ns"
			periodFile="/sys/class/pwm/ecap.1/period_ns"
		/>
		<servoMotor
			port="C3"
			deviceFile="/sys/class/pwm/ecap.2/duty_ns"
			periodFile="/sys/class/pwm/ecap.2/period_ns"
		/>
		<pwmCapture
			port="C1"
			frequencyFile="/sys/class/pwm/ecap_cap.0/freq"
			dutyFile="/sys/class/pwm/ecap_cap.0/duty_percentage"
		/>
		<pwmCapture
			port="C2"
			frequencyFile="/sys/class/pwm/ecap_cap.1/freq"
			dutyFile="/sys/class/pwm/ecap_cap.1/duty_percentage"
		/>
		<pwmCapture
			port="C3"
			frequencyFile="/sys/class/pwm/ecap_cap.2/freq"
			dutyFile="/sys/class/pwm/ecap_cap.2/duty_percentage"
		/>
		<powerMotor port="M1" i2cCommandNumber="0x14" />
		<powerMotor port="M2" i2cCommandNumber="0x15" />
		<powerMotor port="M3" i2cCommandNumber="0x17" />
		<powerMotor port="M4" i2cCommandNumber="0x16" />
		<powerMotor port="S1" i2cCommandNumber="0x3F" />
		<powerMotor port="S2" i2cCommandNumber="0x40" />
		<powerMotor port="S3" i2cCommandNumber="0x41" />
		<powerMotor port="S4" i2cCommandNumber="0x42" />
		<powerMotor port="S5" i2cCommandNumber="0x43" />
		<powerMotor port="S6" i2cCommandNumber="0x44" />
		<powerMotor port="S7" i2cCommandNumber="0x45" />
		<powerMotor port="S8" i2cCommandNumber="0x46" />
		<powerMotor port="S9" i2cCommandNumber="0x47" />
		<powerMotor port="S10" i2cCommandNumber="0x48" />
		<powerMotor port="S11" i2cCommandNumber="0x49" />
		<powerMotor port="S12" i2cCommandNumber="0x4A" />
		<powerMotor port="S13" i2cCommandNumber="0x4B" />
		<powerMotor port="S14" i2cCommandNumber="0x4C" />
		<analogSensor port="A1" i2cCommandNumber="0x25" />
		<analogSensor port="A2" i2cCommandNumber="0x24" />
		<analogSensor port="A3" i2cCommandNumber="0x23" />
		<analogSensor port="A4" i2cCommandNumber="0x22" />
		<analogSensor port="A5" i2cCommandNumber="0x21" />
		<analogSensor port="A6" i2cCommandNumber="0x20" />
		<analogSensor port="T1" i2cCommandNumber="0x4D" />
		<analogSensor port="T2" i2cCommandNumber="0x4E" />
		<analogSensor port="T3" i2cCommandNumber="0x4F" />
		<analogSensor port="W1" i2cCommandNumber="0x50" />
		<analogSensor port="W2" i2cCommandNumber="0x51" />
		<analogSensor port="W3" i2cCommandNumber="0x52" />
		<analogSensor port="W4" i2cCommandNumber="0x53" />
		<analogSensor port="U1_0x11" i2cCommandNumber="0x54" />
		<analogSensor port="U1_0x12" i2cCommandNumber="0x55" />
		<analogSensor port="U1_0x13" i2cCommandNumber="0x56" />
		<analogSensor port="U1_0x14" i2cCommandNumber="0x57" />
		<analogSensor port="U1_0x15" i2cCommandNumber="0x58" />
		<analogSensor port="U1_0x16" i2cCommandNumber="0x59" />
		<analogSensor port="U1_0x17" i2cCommandNumber="0x5A" />
		<analogSensor port="U1_0x18" i2cCommandNumber="0x5B" />
		<analogSensor port="U1_0x19" i2cCommandNumber="0x5C" />
		<analogSensor port="U1_0x1A" i2cCommandNumber="0x5D" />
		<analogSensor port="U1_0x1B" i2cCommandNumber="0x5E" />
		<analogSensor port="U1_0x1C" i2cCommandNumber="0x5F" />
		<analogSensor port="U1_0x1D" i2cCommandNumber="0x60" />
		<analogSensor port="U1_0x1E" i2cCommandNumber="0x61" />
		<analogSensor port="U1_0x1F" i2cCommandNumber="0x62" />
		<analogSensor port="U1_0x20" i2cCommandNumber="0x63" />
		<analogSensor port="U2_0x11" i2cCommandNumber="0x64" />
		<analogSensor port="U2_0x12" i2cCommandNumber="0x65" />
		<analogSensor port="U2_0x13" i2cCommandNumber="0x66" />
		<analogSensor port="U2_0x14" i2cCommandNumber="0x67" />
		<analogSensor port="U2_0x15" i2cCommandNumber="0x68" />
		<analogSensor port="U2_0x16" i2cCommandNumber="0x69" />
		<analogSensor port="U2_0x17" i2cCommandNumber="0x6A" />
		<analogSensor port="U2_0x18" i2cCommandNumber="0x6B" />
		<analogSensor port="U2_0x19" i2cCommandNumber="0x6C" />
		<analogSensor port="U2_0x1A" i2cCommandNumber="0x6D" />
		<analogSensor port="U2_0x1B" i2cCommandNumber="0x6E" />
		<analogSensor port="U2_0x1C" i2cCommandNumber="0x6F" />
		<analogSensor port="U2_0x1D" i2cCommandNumber="0x70" />
		<analogSensor port="U2_0x1E" i2cCommandNumber="0x71" />
		<analogSensor port="U2_0x1F" i2cCommandNumber="0x72" />
		<analogSensor port="U2_0x20" i2cCommandNumber="0x73" />
		<analogSensor port="U3_0x11" i2cCommandNumber="0x74" />
		<analogSensor port="U3_0x12" i2cCommandNumber="0x75" />
		<analogSensor port="U3_0x13" i2cCommandNumber="0x76" />
		<analogSensor port="U3_0x14" i2cCommandNumber="0x77" />
		<analogSensor port="U3_0x15" i2cCommandNumber="0x78" />
		<analogSensor port="U3_0x16" i2cCommandNumber="0x79" />
		<analogSensor port="U3_0x17" i2cCommandNumber="0x7A" />
		<analogSensor port="U3_0x18" i2cCommandNumber="0x7B" />
		<analogSensor port="U3_0x19" i2cCommandNumber="0x7C" />
		<analogSensor port="U3_0x1A" i2cCommandNumber="0x7D" />
		<analogSensor port="U3_0x1B" i2cCommandNumber="0x7E" />
		<analogSensor port="U3_0x1C" i2cCommandNumber="0x7F" />
		<analogSensor port="U3_0x1D" i2cCommandNumber="0x80" />
		<analogSensor port="U3_0x1E" i2cCommandNumber="0x81" />
		<analogSensor port="U3_0x1F" i2cCommandNumber="0x82" />
		<analogSensor port="U3_0x20" i2cCommandNumber="0x83" />
		<analogSensor port="U4_0x11" i2cCommandNumber="0x84" />
		<analogSensor port="U4_0x12" i2cCommandNumber="0x85" />
		<analogSensor port="U4_0x13" i2cCommandNumber="0x86" />
		<analogSensor port="U4_0x14" i2cCommandNumber="0x87" />
		<analogSensor port="U4_0x15" i2cCommandNumber="0x88" />
		<analogSensor port="U4_0x16" i2cCommandNumber="0x89" />
		<analogSensor port="U4_0x17" i2cCommandNumber="0x8A" />
		<analogSensor port="U4_0x18" i2cCommandNumber="0x8B" />
		<analogSensor port="U4_0x19" i2cCommandNumber="0x8C" />
		<analogSensor port="U4_0x1A" i2cCommandNumber="0x8D" />
		<analogSensor port="U4_0x1B" i2cCommandNumber="0x8E" />
		<analogSensor port="U4_0x1C" i2cCommandNumber="0x8F" />
		<analogSensor port="U4_0x1D" i2cCommandNumber="0x90" />
		<analogSensor port="U4_0x1E" i2cCommandNumber="0x91" />
		<analogSensor port="U4_0x1F" i2cCommandNumber="0x92" />
		<analogSensor port="U4_0x20" i2cCommandNumber="0x93" />
		<analogSensor port="U5_0x11" i2cCommandNumber="0x94" />
		<analogSensor port="U5_0x12" i2cCommandNumber="0x95" />
		<analogSensor port="U5_0x13" i2cCommandNumber="0x96" />
		<analogSensor port="U5_0x14" i2cCommandNumber="0x97" />
		<analogSensor port="U5_0x15" i2cCommandNumber="0x98" />
		<analogSensor port="U5_0x16" i2cCommandNumber="0x99" />
		<analogSensor port="U5_0x17" i2cCommandNumber="0x9A" />
		<analogSensor port="U5_0x18" i2cCommandNumber="0x9B" />
		<analogSensor port="U5_0x19" i2cCommandNumber="0x9C" />
		<analogSensor port="U5_0x1A" i2cCommandNumber="0x9D" />
		<analogSensor port="U5_0x1B" i2cCommandNumber="0x9E" />
		<analogSensor port="U5_0x1C" i2cCommandNumber="0x9F" />
		<analogSensor port="U5_0x1D" i2cCommandNumber="0xA0" />
		<analogSensor port="U5_0x1E" i2cCommandNumber="0xA1" />
		<analogSensor port="U5_0x1F" i2cCommandNumber="0xA2" />
		<analogSensor port="U5_0x20" i2cCommandNumber="0xA3" />
		<analogSensor port="U6_0x11" i2cCommandNumber="0xA4" />
		<analogSensor port="U6_0x12" i2cCommandNumber="0xA5" />
		<analogSensor port="U6_0x13" i2cCommandNumber="0xA6" />
		<analogSensor port="U6_0x14" i2cCommandNumber="0xA7" />
		<analogSensor port="U6_0x15" i2cCommandNumber="0xA8" />
		<analogSensor port="U6_0x16" i2cCommandNumber="0xA9" />
		<analogSensor port="U6_0x17" i2cCommandNumber="0xAA" />
		<analogSensor port="U6_0x18" i2cCommandNumber="0xAB" />
		<analogSensor port="U6_0x19" i2cCommandNumber="0xAC" />
		<analogSensor port="U6_0x1A" i2cCommandNumber="0xAD" />
		<analogSensor port="U6_0x1B" i2cCommandNumber="0xAE" />
		<analogSensor port="U6_0x1C" i2cCommandNumber="0xAF" />
		<analogSensor port="U6_0x1D" i2cCommandNumber="0xB0" />
		<analogSensor port="U6_0x1E" i2cCommandNumber="0xB1" />
		<analogSensor port="U6_0x1F" i2cCommandNumber="0xB2" />
		<analogSensor port="U6_0x20" i2cCommandNumber="0xB3" />
		<analogSensor port="U7_0x11" i2cCommandNumber="0xB4" />
		<analogSensor port="U7_0x12" i2cCommandNumber="0xB5" />
		<analogSensor port="U7_0x13" i2cCommandNumber="0xB6" />
		<analogSensor port="U7_0x14" i2cCommandNumber="0xB7" />
		<analogSensor port="U7_0x15" i2cCommandNumber="0xB8" />
		<analogSensor port="U7_0x16" i2cCommandNumber="0xB9" />
		<analogSensor port="U7_0x17" i2cCommandNumber="0xBA" />
		<analogSensor port="U7_0x18" i2cCommandNumber="0xBB" />
		<analogSensor port="U7_0x19" i2cCommandNumber="0xBC" />
		<analogSensor port="U7_0x1A" i2cCommandNumber="0xBD" />
		<analogSensor port="U7_0x1B" i2cCommandNumber="0xBE" />
		<analogSensor port="U7_0x1C" i2cCommandNumber="0xBF" />
		<analogSensor port="U7_0x1D" i2cCommandNumber="0xC0" />
		<analogSensor port="U7_0x1E" i2cCommandNumber="0xC1" />
		<analogSensor port="U7_0x1F" i2cCommandNumber="0xC2" />
		<analogSensor port="U7_0x20" i2cCommandNumber="0xC3" />
		<encoder port="B1" i2cCommandNumber="0x30" />
		<encoder port="B2" i2cCommandNumber="0x31" />
		<encoder port="B3" i2cCommandNumber="0x32" />
		<encoder port="B4" i2cCommandNumber="0x33" />
		<rangeSensor port="D1" eventFile="/dev/input/by-path/platform-trik_jd1-event" module="jd1_hcsr04" />
		<rangeSensor port="D2" eventFile="/dev/input/by-path/platform-trik_jd2-event" module="jd2_hcsr04" />
		<digitalSensor port="F1" deviceFile="/sys/devices/platform/da850_trik/sensor_dc" />
		<lineSensor port="video0" />
		<lineSensor port="video1" />
		<objectSensor port="video0" />
		<objectSensor port="video1" />
		<colorSensor port="video0" />
		<colorSensor port="video1" />
		<soundSensor port="default" />
	</devicePorts>

	<deviceTypes>
		<angularServomotor class="servoMotor" min="600000" max="2200000" zero="1400000" stop="0" type="angular" />
		<continuousRotationServomotor class="servoMotor" min="600000" max="2200000" zero="1400000" stop="0" type="continuousRotation" />
		<irSensor class="analogSensor" rawValue1="0" rawValue2="1023" normalizedValue1="0" normalizedValue2="100" />
		<sonarSensor class="rangeSensor" rawValue1="750" rawValue2="400" normalizedValue1="10" normalizedValue2="20" />
		<lightSensor class="digitalSensor" min="30000" max="350000" />
		<volumeSensor class="digitalSensor" min="0" max="100" />
		<encoder95 class="encoder" ticksInDegree="43.389445" />
		<encoder126 class="encoder" ticksInDegree="32.964168" />
		<colorSensor3x3 class="colorSensor" m="3" n="3" />
	</deviceTypes>

	<!-- Format for playSound command, used to play .wav files. %1 designates file name to be played. -->
	<playWavFile command="aplay --quiet &quot;%1&quot; &amp;" />

	<!-- Format for playSound command, used to play .mp3 files. %1 designates file name to be played. -->
	<playMp3File command="cvlc --quiet &quot;%1&quot; &amp;" />

	<!-- I2C device for communication with power motor drivers. Parameters are path to device file and device id. -->
	<i2c path="/dev/i2c-2" deviceId="0x48" />
</config>
